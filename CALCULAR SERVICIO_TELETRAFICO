import math

def erlang_c(N, A):
    """
    Calcula la fÃ³rmula de Erlang C: C(N, A)
    
    N : nÃºmero de agentes (entero)
    A : trÃ¡fico ofrecido en Erlangs (float)
    """
    
    if N <= A:
        print(f"\nâš ï¸  ERROR: N debe ser mayor que A para que el sistema sea estable.")
        print(f"   N={N} no es mayor que A={A}. El sistema colapsarÃ­a (cola infinita).")
        return None

    # --- Numerador: A^N ---
    numerador = A ** N

    # --- TÃ©rmino 1 del denominador: A^N ---
    termino1 = A ** N

    # --- TÃ©rmino 2: N! * (1 - A/N) * sumatoria ---
    factorial_N = math.factorial(N)
    factor = 1 - (A / N)

    sumatoria = 0
    print("\nğŸ“Š CÃ¡lculo de la sumatoria Î£(A^k / k!) para k=0 hasta N-1:")
    print(f"{'k':<5} {'A^k':<20} {'k!':<15} {'A^k / k!':<15}")
    print("-" * 55)
    for k in range(N):
        ak = A ** k
        kf = math.factorial(k)
        termino = ak / kf
        sumatoria += termino
        print(f"{k:<5} {ak:<20.4f} {kf:<15} {termino:<15.4f}")

    termino2 = factorial_N * factor * sumatoria

    # --- Denominador total ---
    denominador = termino1 + termino2

    # --- Resultado ---
    resultado = numerador / denominador

    return resultado, sumatoria, factorial_N, factor, termino1, termino2, denominador


def main():
    print("=" * 60)
    print("       CALCULADORA DE ERLANG C  â†’  C(N, A)")
    print("=" * 60)
    print()
    print("  FÃ³rmula:")
    print("               A^N")
    print("  C(N,A) = â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€")
    print("            A^N + N! Â· (1 - A/N) Â· Î£(A^k/k!)")
    print()

    while True:
        try:
            N = int(input("ğŸ”¢ Ingresa N (nÃºmero de agentes, entero): "))
            A = float(input("ğŸ“¶ Ingresa A (trÃ¡fico en Erlangs, puede ser decimal con punto): "))
            break
        except ValueError:
            print("âŒ Valor invÃ¡lido. N debe ser entero y A debe ser nÃºmero decimal.\n")

    resultado = erlang_c(N, A)

    if resultado is not None:
        c, sumatoria, fact_N, factor, t1, t2, denom = resultado

        print()
        print("=" * 60)
        print("              ğŸ“‹ RESUMEN DEL CÃLCULO")
        print("=" * 60)
        print(f"  N (agentes)          = {N}")
        print(f"  A (trÃ¡fico Erlangs)  = {A}")
        print(f"  A^N                  = {A**N:.4f}")
        print(f"  N!                   = {fact_N}")
        print(f"  (1 - A/N)            = {factor:.4f}")
        print(f"  Sumatoria Î£(A^k/k!)  = {sumatoria:.4f}")
        print(f"  Numerador            = {t1:.4f}")
        print(f"  Denominador          = {denom:.4f}")
        print()
        print(f"  âœ… C({N}, {A}) = {c:.4f}  â†’  {c*100:.2f}%")
        print("=" * 60)
        print()
        print(f"  ğŸ“Œ InterpretaciÃ³n: Con {N} agentes y {A} Erlangs de trÃ¡fico,")
        print(f"     hay un {c*100:.2f}% de probabilidad de que un cliente")
        print(f"     tenga que ESPERAR antes de ser atendido.")
        print()

        # Bonus: tiempo de espera promedio W y P(W > W0)
        print()
        H_input = input("â±ï¸  Â¿Quieres calcular W y P(W>W0)?\n   Ingresa H (duraciÃ³n media de llamada en segundos) o Enter para omitir: ")
        if H_input.strip() != "":
            try:
                H_val = float(H_input)

                # Tiempo promedio de espera
                W = (c * H_val) / (N - A)
                print(f"\n  â³ Tiempo promedio de espera W = {W:.2f} segundos")
                print(f"     (Para TODOS los clientes, incluyendo los que no esperan)")

                # P(W > W0)
                W0_input = input("\nğŸ¯  Ingresa W0 (tiempo objetivo en segundos): ")
                W0 = float(W0_input)

                import math
                exponente = -(N - A) * (W0 / H_val)
                e_term = math.exp(exponente)
                P = c * e_term

                print()
                print("=" * 60)
                print("       ğŸ“‹ CÃLCULO DE P(W > W0)")
                print("=" * 60)
                print(f"  C(N,A)               = {c:.4f}")
                print(f"  -(N-A) * W0/H        = -({N}-{A}) * {W0}/{H_val} = {exponente:.4f}")
                print(f"  e^({exponente:.4f})         = {e_term:.4f}")
                print()
                print(f"  âœ… P(W > {W0}s) = {c:.4f} Ã— {e_term:.4f} = {P:.4f}  â†’  {P*100:.2f}%")
                print()
                print(f"  ğŸ“Œ El {P*100:.2f}% de clientes esperarÃ¡ MÃS de {W0} segundos.")
                print(f"     El {(1-P)*100:.2f}% serÃ¡ atendido en {W0} segundos o menos.")
                print("=" * 60)

            except ValueError:
                print("  âš ï¸  Valor invÃ¡lido, se omite el cÃ¡lculo.")

    print("\nÂ¿Deseas calcular con otros valores?")
    otra = input("Escribe 'si' para repetir o cualquier tecla para salir: ").strip().lower()
    if otra == "si":
        print()
        main()
    else:
        print("\nğŸ‘‹ Â¡Hasta luego!")


if __name__ == "__main__":
    main()
